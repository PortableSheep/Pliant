/*!
 * MicroVal jQuery plugin v3.2.5 - http://bitbucket.org/rushtheweb/microval/
 * Copyright 2011-2012, Michael Gunderson - Dual licensed under the MIT or GPL Version 2 licenses. Same as jQuery.
 */(function(a){a.microvalPlugins={},a.fn.microval=function(b){var c=this.options=a.extend(!0,{rules:{required:{validate:function(){return this.is("[type=checkbox],[type=radio]")?this.is(":checked"):a.trim(this.val()).length>0},message:"Required"},length:{min:0,max:256,message:"Invalid length",validate:function(a){var b=this.val().length,c=!0;return c&=a.max?b<=a.max:!0,c&=a.min?b>=a.min:!0,c}},numeric:{validate:function(){return/^\d+$/i.test(this.val())},message:"Numeric only"}},fields:[],appendRulesToFieldClass:!1,reconcileFieldOrder:!1,haltOnFirstInvalidRule:!0,hideMessageContainerOnLoad:!0,validateOnFieldChange:!0,focusFirstInvalidField:!1,parseMarkup:!1,ignoreHidden:!0,ignoreDisabled:!0,validateSubmit:!0,validateSubmitSelector:null,validateSubmitOn:"click",validateSubmitScope:null,inputSelector:":input[type!=button]",messageElement:"<label />",messageWrap:null,messageContainer:null,messageElementClass:"mv-element-error",messageWrapClass:"mv-wrap-error",inputClass:"mv-input-error"},b),d=a(this),e=this,f=0,g=this.fields=[],h={},i={},j=function(a,b,c){if(i[a])if(i[a]instanceof Array)for(var d in i[a])i[a][d].apply(b,c||[]);else i[a].apply(b,c||[])},k=function(){f=0;var a="."+c.messageElementClass;for(var b in g){var d=g[b];if(d.isEnabled){var e=!0;for(var h in d.rules){var i=d.rules[h];if(i.isEnabled===!1||c.haltOnFirstInvalidRule&&!Boolean(e)){i.message.hide();continue}e&=i.isValid!==!1,i.message.toggle(i.isValid===!1)}(d.isValid=Boolean(e))===!1?(f++,d.field.is(":input")&&d.field.addClass(c.inputClass)):d.field.is(":input")&&d.field.removeClass(c.inputClass),d.container&&d.container.toggle(d.container.find(a).filter(":mvVisible").length>0)}}c.messageContainer&&c.messageContainer.toggle(c.messageContainer.find(a).filter(":mvVisible").length>0)},l=function(a,b){if(b)for(var c in b)!a.hasOwnProperty(c)&&c!="inherit"&&(a[c]=b[c])},m=function(b){for(var d in b.rules){var e=b.rules[d],f=c.rules[d],g=f&&f.inherit&&c.rules[f.inherit]?c.rules[f.inherit]:null;if((e.message===undefined||!(e.validate===undefined||e.validate instanceof Function))&&!f)throw"Rule `"+d+"` is invalid.";if(f||e.hasOwnProperty("message"))l(e,f),l(e,g),e.message=a(c.messageElement).addClass(c.messageElementClass).append(e.message),c.messageWrap&&(e.message=a(c.messageWrap).addClass(c.messageWrapClass).append(e.message)),e.message.hide(),c.onMessagePlacement?j("onMessagePlacement",b.field,[e.message]):e.container?a(e.container).append(e.message):b.container?a(b.container).append(e.message):c.messageContainer?c.messageContainer.append(e.message):b.field.after(e.message),c.appendRulesToFieldClass&&b.field.addClass(d)}},n=function(a){var b=this;this.isValid=!0,this.isEnabled=!0,this.isValidPrev=!0;for(var d in a)this[d]=a[d];(a.validateOnChange||c.validateOnFieldChange&&a.validateOnChange!==!1)&&this.field.on("change.mvinst",function(){b.Validate(!0,!1,!0)}),this.container&&this.container.hide(),m(a),j("onFieldAdded",this.field,[this])},o=function(a){if(a instanceof Array)for(var b in a)o(a[b]);else if(a.field!==undefined&&a.field.attr("id"))if(c.reconcileFieldOrder){var e=d.find(c.inputSelector).index(a.field);g.splice(e>-1?e:g.length,0,new n(a))}else g.push(new n(a))},p=function(a){a=a instanceof n||a.field!==undefined?a:{field:a};for(var b in g)if(g[b].field.get(0)==a.field.get(0)||g[b].field.attr("id")&&g[b].field.attr("id")==a.field.attr("id"))return b;return-1},q=this.RemoveField=function(a){var b=p(a);if(b>-1){for(var d in g[b].rules)g[b].rules[d].message.remove(),c.appendRulesToFieldClass&&g[b].field.removeClass(d);g.splice(b,1)}},r=this.SetFieldEnabled=function(a,b){var c=p(a);c>-1&&(g[c].isEnabled=b)},s=this.SetFieldRuleEnabled=function(a,b,d){var e=p(a);if(e>-1)for(var f in g[e].rules)if(f==b){g[e].rules[f].isEnabled=d,c.appendRulesToFieldClass&&g[e].field.toggleClass(f,d);break}},t=this.ValidateRule=function(a,b){return c.rules[a]?c.rules[a].validate(b):!1},u=this.ResetState=function(a){if(a==undefined)for(var b in g){g[b].isValid=!0;for(var c in g[b].rules)g[b].rules[c].isValid=!0}else{var d=p(a);if(d>-1){g[d].isValid=!0;for(var e in g[d].rules)g[d].rules[e].isValid=!0}}k()},v=this.SetState=function(a){if(a instanceof Array)for(var b in a)v(a[b]);else{var c=p(a.field);if(c>-1){for(var d in a.rules)g[c].rules[d]&&(g[c].rules[d].isValid=a.rules[d]);k()}}},w=function(a){var b=[];if(a.nodeType===8&&/^\s*{.*}\s*$/.test(a.nodeValue))b.splice(0,0,a.nodeValue);else if(a.childNodes.length>0)for(var c=0;c<a.childNodes.length;c++)b=b.concat(w(a.childNodes[c]));return b},x=this.AddMarkupRules=function(b){var c=b||d,f=a(this),g=w(c[0]),h=null;for(var i in g){var j=a.parseJSON(g[i]);j&&j instanceof Object&&j.hasOwnProperty("field")&&j.hasOwnProperty("rules")&&(j.field=a(j.field),e.AddField(j))}},y=this.ValidateField=function(b){if(!(b instanceof Array)){b instanceof jQuery||(b=a(b));var c=p(b);if(c==-1)throw"Field `"+b.selector+"` cannot be found.";return g[c].Validate(!0,!0,!1)}for(var c in b)y(b[c])};n.prototype.Validate=function(a,b,d){this.isValidPrev=this.isValid,this.isValid=!0;if(this.isEnabled&&!(this.field.is(":disabled")&&c.ignoreDisabled||this.field.is(":hidden")&&c.ignoreHidden)&&!(d&&this.validateOnChange instanceof Function&&this.validateOnChange.call(e,this)===!1)){j("onPreFieldValidate",e,[this]);for(var f in this.rules){var g=this.rules[f];if(g.isEnabled!==!1){if(g.validateOnChange!==undefined&&g.validateOnChange!==!0&&d)if(g.validateOnChange instanceof Function&&g.validateOnChange.call(e,this)===!1||g.validateOnChange===!1){g.isValid=!0;continue}if(c.haltOnFirstInvalidRule&&!this.isValid)break;this.isValid&=g.isValid=Boolean(g.validate?g.validate.call(this.field,g):!0)}}a&&k(),j("onPostFieldValidate",e,[this,this.isValid]),c.validateOnFieldChange&&j("onFieldValidate",e,[this,this.isValid]);if(this.chain&&!b&&d)if(this.chain instanceof Array)for(var h in this.chain)y(this.chain[h]);else y(this.chain)}return this.isValid},this.GetFieldRules=function(a,b,c,d){var e=[];for(var f in g)if(g[f].isEnabled&&!(g[f].field.is(":hidden")&&!a||g[f].field.is(":disabled")&&!b)){var h=[];for(var i in g[f].rules)if(g[f].rules[i].isEnabled!==!1){var j=[];for(var k in g[f].rules[i]){var l=g[f].rules[i][k];if(k=="isValid"||k=="isEnabled"||k=="message"||l===undefined)continue;if(l instanceof jQuery)l=l.attr("id");else if(l instanceof Function&&!c||l instanceof Object&&!d)continue;l!=undefined&&j.push({key:k,value:l})}h.push({name:i,properties:j})}e.push({id:g[f].field.attr("id"),rules:h})}return e},this.Subscribe=function(a,b){return i[a]?i[a].push(b):i[a]=[b],this},this.AddField=function(b){if(b){if(b instanceof Array)for(var c in b)this.AddField(b[c]);else{var c=p(b);if(c>-1&&b.rules!==undefined){for(var d in b.rules)g[c].rules[d]&&g[c].rules[d].message.remove();m(b),g[c].rules=a.extend(!0,g[c].rules,b.rules)}else c==-1&&o(b)}k()}},this.GetInvalidCount=function(){return f},this.TotalFields=function(){return g.length},this.ClearFields=function(){for(var a in g)for(var b in g[a].rules)g[a].rules[b].message.remove(),c.appendRulesToFieldClass&&g[a].field.removeClass(b);g=[],f=0,k()},this.Validate=function(){var a=!0,b=!1;for(var d in g)a&=g[d].Validate(!1,!1,!1),c.focusFirstInvalidField&&!a&&!b&&(j("onInvalidFieldFocus",g[d].field),g[d].field.focus(),b=!0);return k(),a=Boolean(a),j("onFormValidate",this,[g,a]),a};if(c.validateSubmit){var z=function(a){e.Validate()||a.preventDefault()};c.validateSubmitSelector?(c.validateSubmitScope||d).on(c.validateSubmitOn||"click",c.validateSubmitSelector instanceof jQuery?c.validateSubmitSelector.selector:c.validateSubmitSelector,z):d.is("form")&&d.submit(z)}a.expr[":"].mvVisible||(a.expr[":"].mvVisible=function(b){return a(b).css("display")!="none"});for(var A in c.rules)if((c.rules[A].message===undefined||c.rules[A].validate!==undefined&&!(c.rules[A].validate instanceof Function))&&c.rules[A].inherit===undefined)throw"Rule `"+A+"` is invalid.";c.hideMessageContainerOnLoad&&c.messageContainer&&c.messageContainer.hide();for(var B in c)B.slice(0,2)=="on"&&(c[B]instanceof Function||c[B]instanceof Array)&&this.Subscribe(B,c[B]);if(a.microvalPlugins&&c.plugins)for(var C in c.plugins)a.microvalPlugins.hasOwnProperty(C)&&(h[C]=new a.microvalPlugins[C](c.plugins[C],this));return this.AddField(c.fields),k(),c.parseMarkup&&x(),j("onLoadComplete",[this]),this}})(jQuery);