/*!
 * MicroVal jQuery plugin v3.9 - http://bitbucket.org/rushtheweb/microval/
 * Copyright 2011-2012, Michael Gunderson - RushTheWeb.com
 * Dual licensed under the MIT or GPL Version 2 licenses. Same as jQuery.
 */(function(a){a.fn.microval=function(b){var c=a.extend(!0,{rules:{required:{validate:function(){return this.is("[type=checkbox],[type=radio]")?this.is(":checked"):a.trim(this.val()).length>0},message:"Required"},length:{min:0,max:256,validate:function(a){var b=this.val().length,c=!0;return c&=a.max?b<=a.max:!0,c&=a.min?b>=a.min:!0,c},message:"Invalid length"},numeric:{validate:function(){return/^\d+$/i.test(this.val())},message:"Numeric only"},email:{validate:function(){return/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/i.test(this.val())},message:"Invalid email"}},fields:[],appendRulesToFieldClass:!1,reconcileFieldOrder:!1,haltOnFirstInvalidRule:!0,hideMessageContainerOnLoad:!0,validateOnFieldChange:!0,focusFirstInvalidField:!1,ignoreHidden:!0,ignoreDisabled:!0,validateSubmit:!0,validateSubmitSelector:null,validateSubmitOn:"click",inputSelector:":input[type!=button]",parseMarkup:!1,messageElement:"<label />",messageWrap:null,messageContainer:null,messageElementClass:"mv-element-error",messageWrapClass:"mv-wrap-error",inputClass:"mv-input-error",onFieldAdded:null,onFieldValidate:null,onFormValidate:null,onMessagePlacement:null,onInvalidFieldFocus:null},b),d=a(this),e=this,f=0,g=[],h=function(a,b,d){if(c[a])if(c[a]instanceof Array)for(var e in c[a])c[a][e].apply(b,d||[]);else c[a].apply(b,d||[])},i=function(){f=0;var a="."+c.messageElementClass;for(var b in g){var d=g[b];if(d.isEnabled){var e=!0;for(var h in d.rules){var i=d.rules[h];if(i.isEnabled===!1||c.haltOnFirstInvalidRule&&!Boolean(e)){i.message.hide();continue}e&=i.isValid!==!1,i.isValid!==!1?i.message.hide():i.message.show()}(d.isValid=Boolean(e))===!1?(f++,d.field.is(":input")&&d.field.addClass(c.inputClass)):d.field.is(":input")&&d.field.removeClass(c.inputClass),d.container&&(d.container.find(a).filter(":mvVisible").length>0?d.container.show():d.container.hide())}}c.messageContainer&&(c.messageContainer.find(a).filter(":mvVisible").length>0?c.messageContainer.show():c.messageContainer.hide())},j=function(a,b){if(b)for(var c in b)!a.hasOwnProperty(c)&&c!="inherit"&&(a[c]=b[c])},k=function(b){for(var d in b.rules){var e=b.rules[d],f=c.rules[d],g=f&&f.inherit&&c.rules[f.inherit]?c.rules[f.inherit]:null;if(f||e.validate)j(e,f),j(e,g),e.message=a(c.messageElement).addClass(c.messageElementClass).append(e.message),c.messageWrap&&(e.message=a(c.messageWrap).addClass(c.messageWrapClass).append(e.message)),e.message.hide(),c.onMessagePlacement?h("onMessagePlacement",b.field,e.message):e.container?a(e.container).append(e.message):b.container?a(b.container).append(e.message):c.messageContainer?c.messageContainer.append(e.message):b.field.after(e.message),c.appendRulesToFieldClass&&b.field.addClass(d)}},l=function(a){var b=this;this.field=a.field,this.container=a.container,this.rules=a.rules,this.isValid=!0,this.isEnabled=!0,(a.validateOnChange||c.validateOnFieldChange&&a.validateOnChange!==!1)&&this.field.bind("change",function(){b.Validate()}),this.container&&this.container.hide(),k(a),h("onFieldAdded",this.field,[this])},m=function(a){if(a instanceof Array)for(var b in a)m(a[b]);else if(a.field!==undefined&&a.field.attr("id"))if(c.reconcileFieldOrder){var e=d.find(c.inputSelector).index(a.field);g.splice(e>-1?e:g.length,0,new l(a))}else g.push(new l(a))},n=function(a){a=a instanceof l||a.field!==undefined?a:{field:a};for(var b in g)if(g[b].field.get(0)==a.field.get(0)||g[b].field.attr("id")&&g[b].field.attr("id")==a.field.attr("id"))return b;return-1},o=this.RemoveField=function(a){var b=n(a);if(b>-1){for(var d in g[b].rules)g[b].rules[d].message.remove(),c.appendRulesToFieldClass&&g[b].field.removeClass(d);g.splice(b,1)}},p=this.SetFieldEnabled=function(a,b){var c=n(a);c>-1&&(g[c].isEnabled=b)},q=this.SetFieldRuleEnabled=function(a,b,d){var e=n(a);if(e>-1)for(var f in g[e].rules)if(f==b){g[e].rules[f].isEnabled=d,c.appendRulesToFieldClass&&(d?g[e].field.addClass(f):g[e].field.removeClass(f));break}},r=this.ValidateRule=function(a,b){return c.rules[a]?c.rules[a].validate(b):!1},s=this.ResetState=function(a){if(a==undefined)for(var b in g){g[b].isValid=!0;for(var c in g[b].rules)g[b].rules[c].isValid=!0}else{var d=n(a);if(d>-1){g[d].isValid=!0;for(var e in g[d].rules)g[d].rules[e].isValid=!0}}i()},t=this.SetState=function(a){if(a instanceof Array)for(var b in a)t(a[b]);else{var c=n(a.field);if(c>-1){for(var d in a.rules)g[c].rules[d]&&(g[c].rules[d].isValid=a.rules[d]);i()}}},u=this.AddMarkupRules=function(b){var f=a.extend({target:d,inputSelector:c.inputSelector},b);a(f.inputSelector,f.target).each(function(){var b=a(this),c=this.previousSibling,d=null,f=[];while(c){if(c.nodeType===8&&/^\s*{.*}\s*$/.test(c.nodeValue))f.splice(0,0,c.nodeValue);else if(c.nodeType===1)break;c=c.previousSibling}for(var g=0;g<f.length;g++){var h=a.parseJSON(f[g]);h&&h instanceof Object&&(d=d?a.extend(!0,d,h):h)}d&&e.AddField({field:b,rules:d})})};l.prototype.Validate=function(){this.isValid=!0;if(this.isEnabled&&!(this.field.is(":disabled")&&c.ignoreDisabled||this.field.is(":hidden")&&c.ignoreHidden)){for(var a in this.rules){var b=this.rules[a];if(b.isEnabled!==!1){if(c.haltOnFirstInvalidRule&&!this.isValid)break;this.isValid&=b.isValid=Boolean(b.validate?b.validate.call(this.field,b):!1)}}i(),c.validateOnFieldChange&&c.onFieldValidate&&h("onFieldValidate",e,[this,this.isValid])}return this.isValid},this.Subscribe=function(a,b){if(b instanceof Function){if(!c.hasOwnProperty(a))throw"Event `"+a+"` is an invalid event.";return c[a]instanceof Array?c[a].push(b):c[a]=c[a]?[c[a],b]:[b],this}throw"Handler for event `"+a+"` is not a valid function."},this.AddField=function(b){if(b){var c=n(b);if(c>-1&&b.rules!==undefined){for(var d in b.rules)g[c].rules[d]&&g[c].rules[d].message.remove();k(b),g[c].rules=a.extend(!0,g[c].rules,b.rules)}else c==-1&&m(b);i()}},this.GetFieldRules=function(a,b,c,d){var e=[];for(var f in g)if(g[f].isEnabled&&!(g[f].field.is(":hidden")&&!a||g[f].field.is(":disabled")&&!b)){var h=[];for(var i in g[f].rules)if(g[f].rules[i].isEnabled!==!1){var j=[];for(var k in g[f].rules[i]){var l=g[f].rules[i][k];if(k=="isValid"||k=="isEnabled"||k=="message"||l===undefined)continue;if(l instanceof jQuery)l=l.attr("id");else if(l instanceof Function&&!c||l instanceof Object&&!d)continue;l!=undefined&&j.push({key:k,value:l})}h.push({name:i,properties:j})}e.push({id:g[f].field.attr("id"),rules:h})}return e},this.GetInvalidCount=function(){return f},this.TotalFields=function(){return g.length},this.ClearFields=function(){for(var a in g)for(var b in g[a].rules)g[a].rules[b].message.remove(),c.appendRulesToFieldClass&&g[a].field.removeClass(b);g=[],f=0,i()},this.Validate=function(){var a=!0,b=!1;for(var d in g)a&=g[d].Validate(),c.focusFirstInvalidField&&!a&&!b&&(h("onInvalidFieldFocus",g[d].field),g[d].field.focus(),b=!0);return i(),a=Boolean(a),h("onFormValidate",this,[g,a]),a};if(c.validateSubmit){var v=function(a){e.Validate()||a.preventDefault()};c.validateSubmitSelector?d.on(c.validateSubmitOn||"click",c.validateSubmitSelector instanceof jQuery?c.validateSubmitSelector.selector:c.validateSubmitSelector,v):d.is("form")&&d.submit(v)}return a.expr[":"].mvVisible||(a.expr[":"].mvVisible=function(b){return a(b).css("display")!="none"}),m(c.fields),c.parseMarkup&&u(),c.hideMessageContainerOnLoad&&c.messageContainer&&c.messageContainer.hide(),i(),this}})(jQuery);