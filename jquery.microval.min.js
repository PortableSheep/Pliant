/*!
 * MicroVal jQuery plugin v1.8
 * http://bitbucket.org/rushtheweb/microval/
 * Copyright 2011-2012, Michael Gunderson - RushTheWeb.com
 * Dual licensed under the MIT or GPL Version 2 licenses. Same as jQuery.
 */(function(a){a.fn.microval=function(b){var c=a.extend(!0,{rules:{required:{validate:function(){return this.is("[type=checkbox],[type=radio]")?this.is(":checked"):a.trim(this.val()).length>0},message:"Required"},length:{validate:function(a){var b=!0,c=this.val().length;return a.max&&(b&=c<=a.max),a.min&&(b&=c>=a.min),b},message:"Invalid length"},numeric:{validate:function(){return/^\d+$/i.test(this.val())},message:"Numeric only"},email:{validate:function(){return/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/i.test(this.val())},message:"Invalid email"}},fields:[],reconcileFieldOrder:!1,haltOnFirstInvalidRule:!0,hideMessageContainerOnLoad:!0,validateOnFieldChange:!0,focusFirstInvalidField:!1,ignoreHidden:!0,validateSubmit:!0,inputSelector:":input[type!=button]",parseMarkup:!1,messageElement:"<label />",messageWrap:null,messageContainer:null,messageElementClass:"mv-element-error",messageWrapClass:"mv-wrap-error",inputClass:"mv-input-error",onFieldValidate:null,onFormValidate:null,onMessagePlacement:null,onInvalidFieldFocus:null},b),d=a(this),e=this,f=0,g=[],h=function(b){for(var d in b.rules){var e=b.rules[d];if(c.rules[d]||e.validate)e.message=a(c.messageElement).append(e.message||(c.rules[d]&&c.rules[d].message?c.rules[d].message:"")).addClass(c.messageElementClass),c.messageWrap&&(e.message=a(c.messageWrap).append(e.message).addClass(c.messageWrapClass)),e.message.hide(),c.onMessagePlacement?c.onMessagePlacement.call(b.field,e.message):e.container?a(e.container).append(e.message):c.messageContainer?c.messageContainer.append(e.message):b.field.after(e.message)}},i=function(a){var b=this;this.field=a.field,this.rules=a.rules,this.isValid=!0,this.isEnabled=!0,h(a),c.validateOnFieldChange&&this.field.bind("change",function(){b.Validate()})},j=function(a){if(a instanceof Array)for(var b in a)j(a[b]);else if(c.reconcileFieldOrder){var e=d.find(c.inputSelector).index(a.field);g.splice(e>-1?e:g.length,0,new i(a))}else g.push(new i(a))},k=function(a){!(a instanceof i)&&a.field===undefined&&(a={field:a});for(var b in g)if(g[b].field==a.field||g[b].field.attr("id")==a.field.attr("id"))return b;return-1},l=this.RemoveField=function(a){var b=k(a);if(b>-1){for(var c in g[b].rules)g[b].rules[c].message.remove();g.splice(b,1)}},m=this.SetFieldEnabled=function(a,b){var c=k(a);c>-1&&(g[c].isEnabled=b)},n=this.SetFieldRuleEnabled=function(a,b,c){var d=k(a);if(d>-1)for(var e in g[d].rules)if(e==b){g[d].rules[e].isEnabled=c;break}},o=this.ValidateRule=function(a,b){return c.rules[a]?c.rules[a].validate(b):!1},p=this.ResetState=function(){for(var a in g){if(!g[a].isValid){for(var b in g[a].rules)g[a].rules[b].message.hide();g[a].field.removeClass(c.inputClass)}g[a].isValid=!0}f=0,c.messageContainer&&c.messageContainer.hide()},q=function(){if(c.focusFirstInvalidField)for(var a in g)if(!g[a].isValid){c.onInvalidFieldFocus?c.onInvalidFieldFocus.call(g[a].field):g[a].field.focus();break}},r=this.AddMarkupRules=function(b){a(c.inputSelector,b||d).each(function(){var b=a(this),d=this.previousSibling,f={},g=!1,h=[];while(d){if(d.nodeType===8)h.splice(0,0,d.nodeValue);else if(d.nodeType===1)break;d=d.previousSibling}for(var i=0;i<h.length;i++){var j=/\s*validate:(\w+)(?:\[\s*(.*)\s*\]\s*)*/i.exec(h[i]);if(j){var k=j[1],l=j[2]?j[2].split(/\s*\|\s*/):null;if(c.rules[k]){g=!0;var m={};for(var n in l){var o=l[n].split(":",2);if(o){var p=o[0],q=o[1].replace(/^['"]|['"]$/ig,"");switch(p){case"container":var r=a(q);r.length&&(m[p]=r);break;default:m[p]=q}}}f[k]=m}}}g&&e.AddField({field:b,rules:f})})};return i.prototype.Validate=function(){if(this.isEnabled){var a=this.isValid;this.isValid=!0;for(var b in this.rules){var d=this.rules[b];if(d.isEnabled||d.isEnabled==undefined)if(c.haltOnFirstInvalidRule&&this.isValid){var g=d.validate?Boolean(d.validate.call(this.field,d)):Boolean(c.rules[b].validate.call(this.field,d));g?d.message.hide():d.message.show(),this.isValid&=g}else d.message.hide()}return this.isValid?this.field.removeClass(c.inputClass):this.field.addClass(c.inputClass),this.isValid&&!a&&f>0?f--:a&&!this.isValid&&f++,c.validateOnFieldChange&&c.onFieldValidate&&c.onFieldValidate.call(e,this,this.isValid),c.messageContainer&&f>0?c.messageContainer.show():c.messageContainer&&f<=0&&c.messageContainer.hide(),this.isValid}return!0},this.AddField=function(b){if(b){var c=k(b);if(c>-1&&b.rules!==undefined){for(var d in b.rules)g[c].rules[d]&&g[c].rules[d].message.remove();h(b),g[c].rules=a.extend(!0,g[c].rules,b.rules)}else c==-1&&j(b)}},this.GetInvalidCount=function(){return f},this.TotalFields=function(){return g.length},this.ClearFields=function(){for(var a in g)for(var b in g[a].rules)g[a].rules[b].message.remove();g=[],f=0},this.Validate=function(){var a=!0;for(var b in g){if(c.ignoreHidden&&!g[b].field.is(":visible")){g[b].isValid=!0;continue}a&=g[b].Validate()}return a=Boolean(a),a||(q(),c.messageContainer&&c.messageContainer.show()),c.onFormValidate&&c.onFormValidate.call(this,g,a),a},c.validateSubmit&&d.is("form")&&d.submit(function(a){e.Validate()||a.preventDefault()}),j(c.fields),c.parseMarkup&&r(),c.hideMessageContainerOnLoad&&c.messageContainer&&c.messageContainer.hide(),this}})(jQuery);