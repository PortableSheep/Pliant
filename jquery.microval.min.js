/*!
 * MicroVal jQuery plugin v2.3
 * http://bitbucket.org/rushtheweb/microval/
 * Copyright 2011-2012, Michael Gunderson - RushTheWeb.com
 * Dual licensed under the MIT or GPL Version 2 licenses. Same as jQuery.
 */(function(a){a.fn.microval=function(b){var c=a.extend(!0,{rules:{required:{validate:function(){return this.is("[type=checkbox],[type=radio]")?this.is(":checked"):a.trim(this.val()).length>0},message:"Required"},length:{validate:function(a){var b=!0,c=this.val().length;return a.max&&(b&=c<=a.max),a.min&&(b&=c>=a.min),b},message:"Invalid length"},numeric:{validate:function(){return/^\d+$/i.test(this.val())},message:"Numeric only"},email:{validate:function(){return/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/i.test(this.val())},message:"Invalid email"}},fields:[],reconcileFieldOrder:!1,haltOnFirstInvalidRule:!0,hideMessageContainerOnLoad:!0,validateOnFieldChange:!0,focusFirstInvalidField:!1,ignoreHidden:!0,validateSubmit:!0,inputSelector:":input[type!=button]",parseMarkup:!1,messageElement:"<label />",messageWrap:null,messageContainer:null,messageElementClass:"mv-element-error",messageWrapClass:"mv-wrap-error",inputClass:"mv-input-error",onFieldAdded:null,onFieldValidate:null,onFormValidate:null,onMessagePlacement:null,onInvalidFieldFocus:null},b),d=a(this),e=this,f=0,g=[],h=function(a,b,d){if(c[a])if(c[a]instanceof Array)for(var e in c[a])c[a][e].apply(b,d||[]);else c[a].apply(b,d||[])},i=function(){var a=!1;f=0;for(var b in g)if(g[b].isEnabled){var d=!0;for(var e in g[b].rules){var i=g[b].rules[e];if(i.isEnabled===!1||c.haltOnFirstInvalidRule&&!Boolean(d)){i.message.hide();continue}d&=i.isValid!==!1,i.isValid!==!1?g[b].rules[e].message.hide():g[b].rules[e].message.show()}(g[b].isValid=Boolean(d))===!1?(f++,g[b].field.is(":input")&&(g[b].field.addClass(c.inputClass),c.focusFirstInvalidField&&!a&&(h("onInvalidFieldFocus",g[b].field),g[b].field.focus(),a=!0))):g[b].field.is(":input")&&g[b].field.removeClass(c.inputClass)}c.messageContainer&&f>0?c.messageContainer.show():c.messageContainer&&f<=0&&c.messageContainer.hide()},j=function(b){for(var d in b.rules){var e=b.rules[d];if(c.rules[d]||e.validate)e.message=a(c.messageElement).append(e.message||(c.rules[d]&&c.rules[d].message?c.rules[d].message:"")).addClass(c.messageElementClass),c.messageWrap&&(e.message=a(c.messageWrap).append(e.message).addClass(c.messageWrapClass)),e.message.hide(),c.onMessagePlacement?h("onMessagePlacement",b.field,e.message):e.container?a(e.container).append(e.message):c.messageContainer?c.messageContainer.append(e.message):b.field.after(e.message)}},k=function(a){var b=this;this.field=a.field,this.rules=a.rules,this.isValid=!0,this.isEnabled=!0,(a.validateOnChange||c.validateOnFieldChange&&a.validateOnChange!==!1)&&this.field.bind("change",function(){b.Validate(),i()}),j(a),h("onFieldAdded",this.field,this)},l=function(a){if(a instanceof Array)for(var b in a)l(a[b]);else if(c.reconcileFieldOrder){var e=d.find(c.inputSelector).index(a.field);g.splice(e>-1?e:g.length,0,new k(a))}else g.push(new k(a))},m=function(a){a=a instanceof k||a.field!==undefined?a:{field:a};for(var b in g)if(g[b].field==a.field||g[b].field.attr("id")==a.field.attr("id"))return b;return-1},n=this.RemoveField=function(a){var b=m(a);if(b>-1){for(var c in g[b].rules)g[b].rules[c].message.remove();g.splice(b,1)}},o=this.SetFieldEnabled=function(a,b){var c=m(a);c>-1&&(g[c].isEnabled=b)},p=this.SetFieldRuleEnabled=function(a,b,c){var d=m(a);if(d>-1)for(var e in g[d].rules)if(e==b){g[d].rules[e].isEnabled=c;break}},q=this.ValidateRule=function(a,b){return c.rules[a]?c.rules[a].validate(b):!1},r=this.ResetState=function(a){if(a==undefined)for(var b in g){g[b].isValid=!0;for(var c in g[b].rules)g[b].rules[c].isValid=!0}else{var d=m(a);if(d>-1){g[d].isValid=!0;for(var e in g[d].rules)g[d].rules[e].isValid=!0}}i()},s=this.SetState=function(a){if(a instanceof Array)for(var b in a)s(a[b]);else{var c=m(a.field);if(c>-1){for(var d in a.rules)g[c].rules[d]&&(g[c].rules[d].isValid=a.rules[d]);i()}}},t=this.AddMarkupRules=function(b){a(c.inputSelector,b||d).each(function(){var b=a(this),d=this.previousSibling,f={},g=!1,h=[];while(d){if(d.nodeType===8)h.splice(0,0,d.nodeValue);else if(d.nodeType===1)break;d=d.previousSibling}for(var i=0;i<h.length;i++){var j=/\s*validate:(\w+)(?:\[\s*(.*)\s*\]\s*)*/i.exec(h[i]);if(j){var k=j[1],l=j[2]?j[2].split(/\s*\|\s*/):null;if(c.rules[k]){g=!0;var m={};for(var n in l){var o=l[n].split(":",2);if(o){var p=o[0],q=o[1].replace(/^['"]|['"]$/ig,"");switch(p){case"container":var r=a(q);r.length&&(m[p]=r);break;case"isValid":m[p]=q=="true";break;default:m[p]=q}}}f[k]=m}}}g&&e.AddField({field:b,rules:f})})};return k.prototype.Validate=function(){this.isValid=!0;if(this.isEnabled&&(!c.ignoreHidden||!!this.field.is(":visible"))){for(var a in this.rules){var b=this.rules[a];if(b.isEnabled!==!1){if(c.haltOnFirstInvalidRule&&!this.isValid)break;this.isValid&=b.isValid=b.validate?Boolean(b.validate.call(this.field,b)):Boolean(c.rules[a].validate.call(this.field,b))}}c.validateOnFieldChange&&c.onFieldValidate&&h("onFieldValidate",e,[this,this.isValid])}return this.isValid},this.Subscribe=function(a,b){return b instanceof Function?(c[a]instanceof Array?c[a].push(b):c[a]=c[a]?[c[a],b]:[b],this):!1},this.AddField=function(b){if(b){var c=m(b);if(c>-1&&b.rules!==undefined){for(var d in b.rules)g[c].rules[d]&&g[c].rules[d].message.remove();j(b),g[c].rules=a.extend(!0,g[c].rules,b.rules)}else c==-1&&l(b);i()}},this.GetFieldRules=function(a){var b=[];for(var c in g)if(g[c].isEnabled)if(g[c].field.is(":visible")||a){var d=[];for(var e in g[c].rules)if(g[c].rules[e].isEnabled!==!1){var f=[];for(var h in g[c].rules[e])h!="validate"&&h!="message"&&h!="isValid"&&h!="isEnabled"&&f.push({key:h,value:g[c].rules[e][h]});d.push({name:e,properties:f})}b.push({id:g[c].field.attr("id"),rules:d})}return b},this.GetInvalidCount=function(){return f},this.TotalFields=function(){return g.length},this.ClearFields=function(){for(var a in g)for(var b in g[a].rules)g[a].rules[b].message.remove();g=[],f=0,i()},this.Validate=function(){var a=!0;for(var b in g)a&=g[b].Validate();return i(),a=Boolean(a),a||c.messageContainer&&c.messageContainer.show(),h("onFormValidate",this,[g,a]),a},c.validateSubmit&&d.is("form")&&d.submit(function(a){e.Validate()||a.preventDefault()}),l(c.fields),c.parseMarkup&&t(),c.hideMessageContainerOnLoad&&c.messageContainer&&c.messageContainer.hide(),i(),this}})(jQuery);