/*!
 * MicroVal jQuery plugin v3.2 - http://bitbucket.org/rushtheweb/microval/
 * Copyright 2011-2012, Michael Gunderson - RushTheWeb.com
 * Dual licensed under the MIT or GPL Version 2 licenses. Same as jQuery.
 */(function(a){a.fn.microval=function(b){var c=a.extend(!0,{rules:{required:{validate:function(){return this.is("[type=checkbox],[type=radio]")?this.is(":checked"):a.trim(this.val()).length>0},message:"Required"},length:{min:0,max:256,validate:function(a){var b=this.val().length,c=!0;return c&=a.max?b<=a.max:!0,c&=a.min?b>=a.min:!0,c},message:"Invalid length"},numeric:{validate:function(){return/^\d+$/i.test(this.val())},message:"Numeric only"},email:{validate:function(){return/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/i.test(this.val())},message:"Invalid email"}},fields:[],appendRulesToFieldClass:!1,reconcileFieldOrder:!1,haltOnFirstInvalidRule:!0,hideMessageContainerOnLoad:!0,validateOnFieldChange:!0,focusFirstInvalidField:!1,ignoreHidden:!0,ignoreDisabled:!0,validateSubmit:!0,validateSubmitSelector:null,validateSubmitOn:"click",inputSelector:":input[type!=button]",parseMarkup:!1,messageElement:"<label />",messageWrap:null,messageContainer:null,messageElementClass:"mv-element-error",messageWrapClass:"mv-wrap-error",inputClass:"mv-input-error",onFieldAdded:null,onFieldValidate:null,onFormValidate:null,onMessagePlacement:null,onInvalidFieldFocus:null},b),d=a(this),e=this,f=0,g=[],h=function(a,b,d){if(c[a])if(c[a]instanceof Array)for(var e in c[a])c[a][e].apply(b,d||[]);else c[a].apply(b,d||[])},i=function(){var a=!1;f=0;for(var b in g)if(g[b].isEnabled){var d=!0;for(var e in g[b].rules){var i=g[b].rules[e];if(i.isEnabled===!1||c.haltOnFirstInvalidRule&&!Boolean(d)){i.message.hide();continue}d&=i.isValid!==!1,i.isValid!==!1?g[b].rules[e].message.hide():g[b].rules[e].message.show()}(g[b].isValid=Boolean(d))===!1?(f++,g[b].field.is(":input")&&(g[b].field.addClass(c.inputClass),c.focusFirstInvalidField&&!a&&(h("onInvalidFieldFocus",g[b].field),g[b].field.focus(),a=!0))):g[b].field.is(":input")&&g[b].field.removeClass(c.inputClass)}c.messageContainer&&f>0?c.messageContainer.show():c.messageContainer&&f<=0&&c.messageContainer.hide()},j=function(b){for(var d in b.rules){var e=b.rules[d];if(c.rules[d]||e.validate){if(c.rules[d])for(var f in c.rules[d])f!="message"&&f!="validate"&&!e.hasOwnProperty(f)&&(e[f]=c.rules[d][f]);e.message=a(c.messageElement).append(e.message||(c.rules[d]&&c.rules[d].message?c.rules[d].message:"")).addClass(c.messageElementClass),c.messageWrap&&(e.message=a(c.messageWrap).append(e.message).addClass(c.messageWrapClass)),e.message.hide(),c.onMessagePlacement?h("onMessagePlacement",b.field,e.message):e.container?a(e.container).append(e.message):c.messageContainer?c.messageContainer.append(e.message):b.field.after(e.message),c.appendRulesToFieldClass&&b.field.addClass(d)}}},k=function(a){var b=this;this.field=a.field,this.rules=a.rules,this.isValid=!0,this.isEnabled=!0,(a.validateOnChange||c.validateOnFieldChange&&a.validateOnChange!==!1)&&this.field.bind("change",function(){b.Validate(),i()}),j(a),h("onFieldAdded",this.field,this)},l=function(a){if(a instanceof Array)for(var b in a)l(a[b]);else if(a.field!==undefined&&a.field.attr("id"))if(c.reconcileFieldOrder){var e=d.find(c.inputSelector).index(a.field);g.splice(e>-1?e:g.length,0,new k(a))}else g.push(new k(a))},m=function(a){a=a instanceof k||a.field!==undefined?a:{field:a};for(var b in g)if(g[b].field==a.field||g[b].field.attr("id")==a.field.attr("id"))return b;return-1},n=this.RemoveField=function(a){var b=m(a);if(b>-1){for(var d in g[b].rules)g[b].rules[d].message.remove(),c.appendRulesToFieldClass&&g[b].field.removeClass(d);g.splice(b,1)}},o=this.SetFieldEnabled=function(a,b){var c=m(a);c>-1&&(g[c].isEnabled=b)},p=this.SetFieldRuleEnabled=function(a,b,d){var e=m(a);if(e>-1)for(var f in g[e].rules)if(f==b){g[e].rules[f].isEnabled=d,c.appendRulesToFieldClass&&(d?g[e].field.addClass(f):g[e].field.removeClass(f));break}},q=this.ValidateRule=function(a,b){return c.rules[a]?c.rules[a].validate(b):!1},r=this.ResetState=function(a){if(a==undefined)for(var b in g){g[b].isValid=!0;for(var c in g[b].rules)g[b].rules[c].isValid=!0}else{var d=m(a);if(d>-1){g[d].isValid=!0;for(var e in g[d].rules)g[d].rules[e].isValid=!0}}i()},s=this.SetState=function(a){if(a instanceof Array)for(var b in a)s(a[b]);else{var c=m(a.field);if(c>-1){for(var d in a.rules)g[c].rules[d]&&(g[c].rules[d].isValid=a.rules[d]);i()}}},t=this.AddMarkupRules=function(b){a(c.inputSelector,b||d).each(function(){var b=a(this),c=this.previousSibling,d=null,f=[];while(c){if(c.nodeType===8&&/^\s*{.*}\s*$/.test(c.nodeValue))f.splice(0,0,c.nodeValue);else if(c.nodeType===1)break;c=c.previousSibling}for(var g=0;g<f.length;g++){var h=a.parseJSON(f[g]);h&&h instanceof Object&&(d=d?a.extend(!0,d,h):h)}d&&e.AddField({field:b,rules:d})})};k.prototype.Validate=function(){this.isValid=!0;if(this.isEnabled&&!(this.field.is(":disabled")&&c.ignoreDisabled||this.field.is(":hidden")&&c.ignoreHidden)){for(var a in this.rules){var b=this.rules[a];if(b.isEnabled!==!1){if(c.haltOnFirstInvalidRule&&!this.isValid)break;this.isValid&=b.isValid=b.validate?Boolean(b.validate.call(this.field,b)):Boolean(c.rules[a].validate.call(this.field,b))}}c.validateOnFieldChange&&c.onFieldValidate&&h("onFieldValidate",e,[this,this.isValid])}return this.isValid},this.Subscribe=function(a,b){return b instanceof Function?(c[a]instanceof Array?c[a].push(b):c[a]=c[a]?[c[a],b]:[b],this):!1},this.AddField=function(b){if(b){var c=m(b);if(c>-1&&b.rules!==undefined){for(var d in b.rules)g[c].rules[d]&&g[c].rules[d].message.remove();j(b),g[c].rules=a.extend(!0,g[c].rules,b.rules)}else c==-1&&l(b);i()}},this.GetFieldRules=function(a,b){var c=[];for(var d in g)if(g[d].isEnabled&&!(g[d].field.is(":hidden")&&!a||g[d].field.is(":disabled")&&!b)){var e=[];for(var f in g[d].rules)if(g[d].rules[f].isEnabled!==!1){var h=[];for(var i in g[d].rules[f])if(i!="validate"&&i!="message"&&i!="isValid"&&i!="isEnabled"){var j=g[d].rules[f][i];j instanceof jQuery&&(j=j.attr("id")),h.push({key:i,value:j})}e.push({name:f,properties:h})}c.push({id:g[d].field.attr("id"),rules:e})}return c},this.GetInvalidCount=function(){return f},this.TotalFields=function(){return g.length},this.ClearFields=function(){for(var a in g)for(var b in g[a].rules)g[a].rules[b].message.remove(),c.appendRulesToFieldClass&&g[a].field.removeClass(b);g=[],f=0,i()},this.Validate=function(){var a=!0;for(var b in g)a&=g[b].Validate();return i(),a=Boolean(a),a||c.messageContainer&&c.messageContainer.show(),h("onFormValidate",this,[g,a]),a};if(c.validateSubmit){var u=function(a){e.Validate()||a.preventDefault()};c.validateSubmitSelector?d.on(c.validateSubmitOn||"click",c.validateSubmitSelector,u):d.is("form")&&d.submit(u)}return l(c.fields),c.parseMarkup&&t(),c.hideMessageContainerOnLoad&&c.messageContainer&&c.messageContainer.hide(),i(),this}})(jQuery);